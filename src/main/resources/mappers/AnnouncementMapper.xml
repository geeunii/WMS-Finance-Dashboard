<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssg.wms.announcement.mappers.AnnouncementMapper">

    <select id="selectAnnouncements" resultType="com.ssg.wms.announcement.dto.AnnouncementDTO">
        SELECT *
        FROM announcement
        WHERE status = 'AVAILABLE'
        <if test="keyword != null and keyword != ''">
            AND title LIKE CONCAT('%', #{keyword}, '%')
        </if>
        ORDER BY is_important DESC, created_at DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <select id="countAnnouncements" resultType="int">
        SELECT COUNT(*)
        FROM announcement
        WHERE status = 'AVAILABLE'
        <if test="keyword != null and keyword != ''">
            AND title LIKE CONCAT('%', #{keyword}, '%')
        </if>
    </select>

    <select id="selectAnnouncementById" resultType="com.ssg.wms.announcement.dto.AnnouncementDTO">
        SELECT *
        FROM announcement
        WHERE announcement_id = #{id}
    </select>

    <insert id="insertAnnouncement" useGeneratedKeys="true" keyProperty="announcementId">
        INSERT INTO announcement (title, content, writer, is_important)
        VALUES (#{title}, #{content}, #{writer}, #{isImportant});
    </insert>

    <update id="updateAnnouncement">
        UPDATE announcement
        SET title = #{title},
            content = #{content},
            is_important = #{isImportant},
            updated_at = NOW()
        WHERE announcement_id = #{announcementId};
    </update>

    <update id="deleteAnnouncement">
        UPDATE announcement
        SET status = 'DELETED'
        WHERE announcement_id = #{id}
    </update>

</mapper>