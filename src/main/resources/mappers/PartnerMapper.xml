<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssg.wms.partner.mappers.PartnerMapper">

    <!-- 거래처 목록 조회 -->
    <select id="selectPartners" parameterType="PartnerDTO" resultType="PartnerDTO">
        SELECT
        partner_id,
        partner_name,
        business_number,
        address,
        created_at,
        updated_at
        FROM partner
        WHERE 1=1
        <if test="partnerId != null">
            AND partner_id = #{partnerId}
        </if>
        <if test="partnerName != null and partnerName != ''">
            AND partner_name LIKE CONCAT('%', #{partnerName}, '%')
        </if>
        <if test="businessNumber != null and businessNumber != ''">
            AND business_number = #{businessNumber}
        </if>
        ORDER BY partner_name DESC
    </select>

    <!-- 거래처 요금 정책 조회 -->
    <select id="selectPartnerFees" parameterType="PartnerFeeDTO" resultType="PartnerFeeDTO">
        SELECT
        fee_id,
        partner_id,
        fee_type,
        price,
        apply_date
        FROM partner_fee
        WHERE 1=1
        <if test="feeId != null">
            AND fee_id = #{feeId}
        </if>
        <if test="partnerId != null">
            AND partner_id = #{partnerId}
        </if>
        <if test="feeType != null and feeType != ''">
            AND fee_type = #{feeType}
        </if>
        ORDER BY apply_date DESC
    </select>

    <!-- 거래처 계약 정보 조회 -->
    <select id="selectPartnerContracts" parameterType="PartnerContractDTO" resultType="PartnerContractDTO">
        SELECT
        contract_id,
        partner_id,
        contract_start,
        contract_area,
        contract_status
        FROM partner_contract
        WHERE 1=1
        <if test="contractId != null">
            AND contract_id = #{contractId}
        </if>
        <if test="partnerId != null">
            AND partner_id = #{partnerId}
        </if>
        <if test="contractStart != null">
            AND contract_start &gt;= #{contractStart}
        </if>
        <if test="contractStart != null">
            AND contract_start &lt;= DATE_ADD(#{contractStart}, INTERVAL 1 DAY)
        </if>
        <if test="status != null and status != ''">
            AND status LIKE #{status}
        </if>
        ORDER BY contract_start DESC
    </select>

</mapper>