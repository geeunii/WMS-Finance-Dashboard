<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssg.wms.admin.mappers.AdminMapper">

    <resultMap id="StaffResultMap" type="com.ssg.wms.admin.domain.Staff">
        <id property="staffId" column="staff_id"/>
        <result property="staffLoginId" column="staff_login_id"/>
        <result property="staffName" column="staff_name"/>
        <result property="staffPw" column="staff_pw"/>
        <result property="staffPhone" column="staff_phone"/>
        <result property="staffEmail" column="staff_email"/>
        <result property="role" column="role"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 직원 정보 조회 -->
    <select id="getStaffDetails" resultType="StaffDTO">
        SELECT staff_login_id, staff_name, staff_phone, staff_email, role, status, created_at, updated_at
        FROM staff
        WHERE staff_id = #{staffId}
    </select>

    <!-- 고객 목록 조회 (검색 조건 적용) -->
    <select id="getMembersByCriteria" parameterType="MemberCriteria" resultType="Member">
        SELECT *
        FROM member
        WHERE 1=1
        <if test="keyword != null and keyword != ''">
            AND (member_login_id LIKE CONCAT('%', #{keyword}, '%')
            OR member_name LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        <if test="status != null">
            AND status LIKE #{status}
        </if>
        <if test="startDate != null">
            AND created_at &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND created_at &lt;= DATE_ADD(#{endDate}, INTERVAL 1 DAY)
        </if>
        ORDER BY created_at DESC
        LIMIT #{skip}, #{amount}
    </select>

    <select id="getMemberTotalCount" parameterType="MemberCriteria" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE 1=1
        <if test="keyword != null and keyword != ''">
            AND (member_login_id LIKE CONCAT('%', #{keyword}, '%')
            OR member_name LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        <if test="startDate != null">
            AND created_at &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND created_at &lt;= DATE_ADD(#{endDate}, INTERVAL 1 DAY)
        </if>
    </select>

    <!-- 고객 상세 조회 -->
    <select id="getMemberDetails" resultType="Member">
        SELECT member_id,
               member_login_id,
               member_name,
               member_phone,
               member_email,
               status,
               created_at,
               updated_at,
               business_number
        FROM member
        WHERE member_id = #{memberId}
    </select>

    <!-- 로그인 id로 직원 id 조회 -->
    <select id="findStaffIdByStaffLoginId" resultType="long">
        SELECT staff_id
        FROM staff
        WHERE staff_login_id = #{staffLoginId}
    </select>

    <select id="getPage" resultType="MemberDTO">
        select * from
        member
        where member_id > 0
<!--        <include refid="search"/>-->
        order by member_id desc
        limit #{skip}, #{amount}
    </select>

    <update id="updateMemberStatus">
        UPDATE member
        SET status = #{status}
        WHERE member_id = #{memberId}
    </update>

    <!--  로그인ID + PW로 직원 정보 얻기  -->
    <select id="findByLoginIdAndPw" parameterType="String" resultType="com.ssg.wms.admin.domain.Staff">
        SELECT * FROM staff WHERE staff_login_id = #{loginId}
        AND staff_pw = #{password}
    </select>

</mapper>