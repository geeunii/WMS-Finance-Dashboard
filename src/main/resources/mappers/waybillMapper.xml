<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssg.wms.mappers.waybillMapper">


    <select id="getWaybillById">
        select waybill_id,
        waybill_number,
        waybill_date,
        waybill_status,
        departure_Address,
        arrival_Address,
        sender_Name,
        receiver_Name,
        d.loadedBOX
        from waybill
        join dispatch d on waybill.dispatch_ID = d.dispatch_ID
        where waybill_number = #{waybill_number};
    </select>



    <select id="getWaybills" resultType="WaybillDTO">
        waybill_id,
        waybill_number,
        watbiiDate,
        waybillStatus,
        senderName,
        receiverName
        FROM
        waybill
        <where>
            <if test="search != null and search != ''">
                AND (
                waybill_number LIKE CONCAT('%', #{search}, '%')
                OR senderName LIKE CONCAT('%', #{search}, '%')
                OR receiverName LIKE CONCAT('%', #{search}, '%')
                )
            </if>

        </where>

        ORDER BY watbiiDate DESC   <if test="criteria != null">
        LIMIT #{criteria.amount} OFFSET #{criteria.skip}
    </if>
    </select>


    <update id="updateWaybill">
        UPDATE waybill
        SET
        departureAddress = #{waybillDTO.departureAddress},
        arrivalAddress = #{waybillDTO.arrivalAddress},
        senderName = #{waybillDTO.senderName},
        receiverName = #{waybillDTO.receiverName},
        WHERE
        waybill_id = #{waybillDTO.waybillId}
    </update>




</mapper>